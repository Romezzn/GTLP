<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tamagotchi TLP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --color-bg: #23242a;
      --color-panel: #23263cbb;
      --color-card: #23263c;
      --color-tile: #32343d;
      --color-glow: #4b8cff;
      --radius: 18px;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: var(--color-bg);
      font-family: 'Nunito', 'Segoe UI', 'Arial', sans-serif;
      color: #f3f4fa;
    }
    body {
      min-height: 100vh;
      overflow: hidden;
    }
    #main {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      justify-content: center;
      height: 100vh;
      width: 100vw;
      box-sizing: border-box;
      background: linear-gradient(120deg, #292c3b 0%, #313d51 100%);
    }
    #canvas-container {
      flex: 1 1 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 0;
      min-height: 0;
      overflow: hidden;
      background: var(--color-tile);
      border-radius: var(--radius);
      margin: 16px 0 16px 16px;
      box-shadow: 0 4px 28px #0007;
    }
    #canvas {
      display: block;
      background: transparent;
      border-radius: var(--radius);
      outline: none;
      width: 100%;
      height: 100%;
      object-fit: contain;
      box-shadow: 0 2px 18px #0008;
      max-width: 98vw;
      max-height: 93vh;
      image-rendering: pixelated;
      transition: box-shadow .15s;
    }
    #sidepanel {
      min-width: 340px;
      max-width: 420px;
      width: 360px;
      background: var(--color-panel);
      border-radius: var(--radius);
      margin: 18px 18px 18px 0;
      padding: 24px 24px 20px 24px;
      box-shadow: 0 2px 24px #0006;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      font-size: 1.06em;
      position: relative;
    }
    #sidepanel h1 {
      font-family: 'Nunito', 'Segoe UI', 'Arial', sans-serif;
      margin: 0 0 12px 0;
      color: #7fd1fa;
      font-size: 2em;
      letter-spacing: 1.5px;
      text-shadow: 0 2px 12px #01262a3c;
      font-weight: 800;
    }
    #sidepanel .subtitle {
      color: #d1beff;
      margin-bottom: 18px;
      font-size: 1.11em;
      letter-spacing: 0.1em;
      font-weight: 600;
      text-shadow: 0 1px 6px #3336;
    }
    #sidepanel .panel-section {
      margin-bottom: 1.25em;
    }
    .criatura {
      background: var(--color-card);
      border-radius: 13px;
      margin-bottom: 12px;
      padding: 14px 18px 14px 16px;
      border: 2px solid #3765ba33;
      box-shadow: 0 2px 15px #0003;
      position: relative;
      transition: box-shadow .12s, border-color .15s;
      font-size: 1em;
    }
    .criatura.selected {
      border: 2px solid var(--color-glow);
      box-shadow: 0 0 0 1.5px var(--color-glow),0 2px 15px #000a;
      background: #27365daa;
    }
    .stat-bar, .stat-bar-vert {
      margin-bottom: 0.4em;
    }
    .stat-bar .stat-text {
      font-size: 13px;
      font-weight: 600;
    }
    .stat-bar-vert {
      margin: 0 4px 0 0;
    }
    #event-log {
      position: fixed;
      top: 18px;
      right: 32px;
      width: 360px;
      max-height: 32vh;
      min-height: 54px;
      z-index: 200;
      display: flex;
      flex-direction: column-reverse;
      overflow-y: auto;
      padding: 0;
      align-items: flex-end;
      background: transparent;
      font-size: 1.1em;
      pointer-events: none;
    }
    .log-msg.good { color: #8bffad; }
    .log-msg.warn { color: #ffd176; }
    .log-msg.emo { color: #9ad2ff; }
    .log-msg { margin-bottom: 3px; }
    #stat-overlay {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      background: #22262cfa;
      color: #fff;
      font-size: 1.2em;
      border-radius: 14px;
      padding: 9px 48px 10px 48px;
      z-index: 40;
      box-shadow: 0 0 18px #0007;
      pointer-events: none;
      min-width: 360px;
      text-align: center;
      font-weight: 600;
      letter-spacing: 0.04em;
      border: 1.5px solid #7fd1fa44;
    }
    /* Zoom buttons */
    .zoom-ui {
      position: fixed;
      top: 62px;
      right: 17px;
      z-index: 99;
      background: #233d55ee;
      border-radius: 11px;
      padding: 8px 15px;
      box-shadow: 0 2px 10px #0007;
      display: flex;
      gap: 10px;
      align-items: center;
      backdrop-filter: blur(2px);
    }
    .zoom-ui button {
      font-size: 1.35em;
      border-radius: 5px;
      margin: 4px;
      padding: 2px 10px;
      background: #263d5e;
      color: #fff;
      border: 1px solid #5396e0;
      cursor: pointer;
      transition: background .13s, color .13s;
    }
    .zoom-ui button:hover {
      background: #5396e0;
      color: #fff;
    }
    /* Floating buttons */
    .floating-btn {
      position: fixed;
      right: 24px;
      background: #2a2e4c;
      color: #fff;
      border: none;
      border-radius: 13px;
      font-size: 1.23em;
      padding: 15px 24px;
      z-index: 99;
      box-shadow: 0 3px 14px #0006;
      cursor: pointer;
      transition: background .15s, box-shadow .15s;
      font-weight: 700;
    }
    #btn-cris { bottom: 24px; background: #3f3c6b; }
    #btn-cris:hover { background: #5162e6; }
    #btn-musica { bottom: 90px; background: #2196f3; }
    #btn-musica:hover { background: #5bb0f8; }
    /* --- MOVIL: barra lateral de stats y menú de objetos --- */
    @media (max-width: 800px) {
      #main { flex-direction: column; }
      #sidepanel, #stat-overlay {
        display: none !important;
      }
      #canvas-container {
        margin: 0 !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        width: 100vw !important;
        height: 100vh !important;
        min-width: 100vw !important;
        min-height: 100vh !important;
      }
      #canvas {
        border-radius: 0 !important;
        box-shadow: none !important;
        max-width: 100vw !important;
        max-height: 100vh !important;
        width: 100vw !important;
        height: 100vh !important;
      }
      #stat-vertical {
        display: flex !important;
        position: fixed;
        top: 0; left: 0;
        height: 100vh;
        width: 52px;
        flex-direction: column;
        align-items: center;
        z-index: 110;
        background: rgba(30,34,48,0.94);
        border-radius: 0 18px 18px 0;
        box-shadow: 0 0 14px #2229;
        padding: 7px 2px 12px 2px;
        gap: 9px;
      }
      .stat-mini {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: 0.81em;
        color: #fff;
        margin-bottom: 1.1em;
      }
      .stat-mini .em { font-size: 1.23em; }
      .stat-mini .val { font-size: 0.95em; margin-top: -2px; }
      .stat-mini .lbl { font-size: 0.82em; color: #8fe; margin-top: -2px; }
      #mobile-obj-btn {
        display: flex;
        position: fixed;
        right: 16px; bottom: 16px;
        z-index: 220;
        background: #1e3055;
        border-radius: 50%;
        box-shadow: 0 2px 12px #0007;
        width: 54px; height: 54px;
        align-items: center; justify-content: center;
        font-size: 2em; color: #fff;
        border: 2px solid #6cf;
        cursor: pointer;
      }
      #mobile-obj-panel {
        display: none;
        position: fixed;
        left: 0; top: 0; right: 0; bottom: 0;
        z-index: 500;
        background: rgba(10,16,30,0.97);
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 22px;
      }
      #mobile-obj-panel.active {
        display: flex;
      }
      .objeto-boton-mobile {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.2em;
        background: #263d5e;
        color: #fff;
        border-radius: 12px;
        border: none;
        padding: 13px 20px;
        box-shadow: 0 2px 11px #0007;
        font-weight: bold;
        margin-bottom: 8px;
        cursor: pointer;
      }
    }
    @media (min-width: 801px) {
      #stat-vertical, #mobile-obj-btn, #mobile-obj-panel {
        display: none !important;
      }
    }
    button { font-family: inherit; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;900&display=swap" rel="stylesheet">
</head>
<body>
  <div id="main">
    <div id="canvas-container">
      <canvas id="canvas" tabindex="0"></canvas>
      <!-- Barra de stats vertical en móvil -->
      <div id="stat-vertical"></div>
      <!-- Botón menú objetos móvil -->
      <button id="mobile-obj-btn" title="Objetos" style="display:none;"><span>🎒</span></button>
      <!-- Panel de objetos móvil -->
      <div id="mobile-obj-panel"></div>
    </div>
    <div id="sidepanel">
      <h1>Tamagotchi TLP</h1>
      <div class="subtitle">Cuidando mente y emociones</div>
      <div id="criaturasPanel" class="panel-section"></div>
      <div id="main-controls" class="panel-section">
        <b>Turno:</b> <span id="turnoNum">0</span>
      </div>
      <div class="panel-section" style="margin-top:10px; color:#b0f;">
        <p style="margin:0;">
          Interactúa y ayuda a tu criatura.<br>
          Si no juegas en <b>10s</b>, perderá confianza y vínculo.<br>
          Cada minuto avanza un turno.<br>
          Explora el mapa, usa objetos y busca sorpresas.
        </p>
      </div>
      <div style="margin-top:14px; font-size:0.92em; color:#6fe;">
        <p style="margin:0;">
          <b>Consejo:</b> Pulsa y arrastra el mapa para moverlo. Usa el zoom para ver más detalles.
        </p>
      </div>
    </div>
  </div>
  <!-- El log flotante lo crea game.js dinámicamente -->
  <audio id="moveSfx" src="move.wav"></audio>
  <audio id="okSfx" src="ok.wav"></audio>
  <audio id="errSfx" src="err.wav"></audio>
  <script>
    function resizeCanvas() {
      // Tamaño máximo visible que no deforma el canvas
      const canvas = document.getElementById('canvas');
      const dpr = window.devicePixelRatio || 1;
      // Calcula el tamaño real disponible
      const container = document.getElementById('canvas-container');
      let w = container.offsetWidth;
      let h = container.offsetHeight;
      // Si estamos en móvil, el container puede tener height=0, usar window size
      if (!h) h = window.innerHeight;
      if (!w) w = window.innerWidth;
      // Mantén aspecto
      const aspect = 24 / 16;
      let cw = Math.min(w, h * aspect);
      let ch = Math.min(h, w / aspect);
      // Ajusta el tamaño físico (para evitar pixelado)
      canvas.width = Math.round(cw * dpr);
      canvas.height = Math.round(ch * dpr);
      canvas.style.width = cw + 'px';
      canvas.style.height = ch + 'px';
    }
    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('DOMContentLoaded', resizeCanvas);
  </script>
  <script src="game.js"></script>
  <!-- UI móvil: stats barra vertical y menú objetos -->
  <script>
    // Barra de stats vertical móvil - ahora a la IZQUIERDA y robusta para "cargando"
    function renderStatVertical() {
      const c = window.criaturas?.[0] || (window.CONFIG && window.CONFIG.personaje);
      const el = document.getElementById('stat-vertical');
      if (!el) return;
      if (!c || !c.stats) {
        el.innerHTML = '<div style="margin-top:2em;color:#fff;font-size:1.1em;">Cargando…</div>';
        return;
      }
      el.innerHTML = [
        { k:'hambre',     em:'😋', col:'#b3b703', lbl:'Ham', v:c.stats?.hambre || 0 },
        { k:'felicidad',  em:'😊', col:'#f2c53d', lbl:'Feli', v:c.stats?.felicidad || 0 },
        { k:'energia',    em:'⚡', col:'#19d5e4', lbl:'En', v:c.stats?.energia || 0 },
        { k:'confianza',  em:'🤝', col:'#b39ddb', lbl:'Con', v:c.stats?.confianza || 0 },
        { k:'vinculo',    em:'💞', col:'#ec6', lbl:'Vín', v:c.vinculo || 0 },
        { k:'saludMental',em:'🧠', col:'#21e27b', lbl:'Ment', v:c.stats?.saludMental || 0 },
        { k:'saludFisica',em:'💪', col:'#f58f3b', lbl:'Fís', v:c.stats?.saludFisica || 0 },
        { k:'ansiedad',   em:'😰', col:'#e56', lbl:'Ans', v:c.ansiedad || 0 },
        { k:'depresion',  em:'🥀', col:'#5a34a3', lbl:'Dep', v:c.stats?.depresion || 0 }
      ].map(stat =>
        `<div class="stat-mini" style="color:${stat.col}">
          <span class="em">${stat.em}</span>
          <span class="val">${Math.round(stat.v)}</span>
          <span class="lbl">${stat.lbl}</span>
        </div>`
      ).join('');
    }
    // Menú de objetos móvil
    function renderMobileObjetos() {
      const panel = document.getElementById('mobile-obj-panel');
      if (!panel) return;
      panel.innerHTML = '<button onclick="document.getElementById(\'mobile-obj-panel\').classList.remove(\'active\')" style="position:absolute;top:24px;right:32px;font-size:2.2em;background:none;border:none;color:#fff;z-index:900;">✖️</button>';
      if (!window.CONFIG || !window.criaturas) return;
      const c = window.criaturas[0];
      window.CONFIG.objetos.forEach(obj => {
        let cooldown = c.cooldowns?.[obj.id] || 0;
        let blocked = !window.puedeUsarObjeto ? false : !window.puedeUsarObjeto(c, obj);
        let disabled = cooldown > 0 || blocked;
        let btn = document.createElement('button');
        btn.className = "objeto-boton-mobile";
        btn.innerHTML = `<span style="font-size:1.5em">${obj.icon}</span> <span>${obj.name}</span>`;
        btn.disabled = disabled;
        btn.style.opacity = disabled ? 0.6 : 1;
        btn.onclick = () => {
          if (disabled) return;
          document.getElementById('mobile-obj-panel').classList.remove('active');
          if (window.usarObjeto) window.usarObjeto(c, obj, true);
        };
        panel.appendChild(btn);
      });
    }
    // Mostrar/ocultar menú objetos móvil
    function showMobileObjBtnIfNeeded() {
      const btn = document.getElementById('mobile-obj-btn');
      if (window.innerWidth <= 800) btn.style.display = 'flex';
      else btn.style.display = 'none';
    }
    document.getElementById('mobile-obj-btn').onclick = () => {
      document.getElementById('mobile-obj-panel').classList.add('active');
      renderMobileObjetos();
    };
    window.renderStatVertical = renderStatVertical;
    window.renderMobileObjetos = renderMobileObjetos;
    window.addEventListener('resize', showMobileObjBtnIfNeeded);
    window.addEventListener('DOMContentLoaded', showMobileObjBtnIfNeeded);
    // Llama a renderStatVertical en cada UI update (hazlo desde game.js también)
    function tryMobileUIUpdate() {
      if (window.innerWidth <= 800) {
        renderStatVertical();
      }
    }
    window.addEventListener('resize', tryMobileUIUpdate);
    window.addEventListener('DOMContentLoaded', tryMobileUIUpdate);
  </script>
</body>
</html>
